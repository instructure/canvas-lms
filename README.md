Canvas LMS
======

Canvas is a modern, open-source [LMS](https://en.wikipedia.org/wiki/Learning_management_system)
developed and maintained by [Instructure Inc.](https://www.instructure.com/) It is released under the
AGPLv3 license for use by anyone interested in learning more about or using
learning management systems.

[Please see our main wiki page for more information](http://github.com/instructure/canvas-lms/wiki)

Installation
=======

Detailed instructions for installation and configuration of Canvas are provided
on our wiki.

 * [Quick Start](http://github.com/instructure/canvas-lms/wiki/Quick-Start)
 * [Production Start](http://github.com/instructure/canvas-lms/wiki/Production-Start)


# local canvas-lms
docker compose -f docker-compose.yml  -f ./docker-compose/rce-api.override.yml up -d


# in web container and job container
rm -rf app;rm -rf config;rm -rf log;rm -rf node_modules;rm -rf packages;rm -rf pacts;rm -rf public;rm -rf reports;rm -rf tmp;cp -r  ../canvas/app ./ ;cp -r  ../canvas/config ./ ;cp -r  ../canvas/node_modules ./ ;cp -r  ../canvas/packages ./ ;cp -r  ../canvas/pacts ./ ;cp -r  ../canvas/public ./ ;cp -r  ../canvas/reports ./ ;cp -r  ../canvas/tmp ./ ;cp -r ../canvas/script ./;cp -r ../canvas/gems ./ ;cp -r ../canvas/lib ./;cp -r ../canvas/ui ./;cp -r ../canvas/ui-build ./;cp -r ../canvas/vendor ./;cp -r ../canvas/Gemfile.d ./;cp -r ../canvas/spec ./;
cp -r ../canvas/bin ./;cp -r ../canvas/db ./;
cp -r ../canvas/doc ./;
cp -f ../canvas/config/environments/production.rb ./config/environments/production.rb;
find ../canvas/ -maxdepth 1 -type f -exec cp {} ./  \;
bundle config set --local path vendor/bundle;
bundle install;
yarn install;
for config in amazon_s3 database vault_contents   delayed_jobs domain file_store outgoing_mail security external_migration;   do cp config/$config.yml.example config/$config.yml; done;
cp config/dynamic_settings.yml.example config/dynamic_settings.yml;cp config/domain.yml.example config/domain.yml;
cp ../canvas/config/outgoing_mail.yml.example config/outgoing_mail.yml;
cp ../canvas/config/security.yml.example config/security.yml;
cp ../canvas/config/database.yml.example config/database.yml;
cp ../canvas/config/vault_contents.yml.example config/vault_contents.yml;
cp ../canvas/config/cache_store.yml.example config/cache_store.yml;
cp ../canvas/config/delayed_jobs.yml.example config/delayed_jobs.yml;
yarn gulp rev;
RAILS_ENV=production bundle exec rake db:initial_setup;

# input texts
mkdir -p log tmp/pids public/assets app/stylesheets/brandable_css_brands;
touch app/stylesheets/_brandable_variables_defaults_autogenerated.scss;
touch Gemfile.lock;
touch log/production.log;
RAILS_ENV=production bundle exec rake canvas:compile_assets;
cp ../canvas/nginxconf/customize.conf /usr/src/nginx/location.d/;
cp ../canvas/nginxconf/nginx.conf /usr/src/nginx/nginx.conf;

# restart web container 

# in rce api container
cp -f ../canvas-rce-api/app/api/wrapCanvas.js ./app/api/wrapCanvas.js
```

# webコンテナ内で以下のコマンドを実行
mkdir ssl
mkdir ssl/rce-api

# webコンテナ用に証明書を配置する
sudo docker cp /home/taishiro_murata/canvas-lms/nginxconf/ssl/canvas-lms/fullchain.pem canvas-lms-web-1:/usr/src/app/ssl/fullchain.pem
sudo docker cp /home/taishiro_murata/canvas-lms/nginxconf/ssl/canvas-lms/privkey.pem canvas-lms-web-1:/usr/src/app/ssl/privkey.pem

webコンテナ用にrce api用の証明書を配置する
sudo docker cp /home/taishiro_murata/canvas-lms/nginxconf/ssl/canvas-lms-rce-api/fullchain.pem canvas-lms-web-1:/usr/src/app/ssl/rce-api/fullchain.pem
sudo docker cp /home/taishiro_murata/canvas-lms/nginxconf/ssl/canvas-lms-rce-api/privkey.pem canvas-lms-web-1:/usr/src/app/ssl/rce-api/privkey.pem

# jobsコンテナ用に証明書を配置する
sudo docker cp /home/taishiro_murata/canvas-lms/nginxconf/ssl/canvas-lms/fullchain.pem canvas-lms-jobs-1:/usr/src/app/ssl/fullchain.pem
sudo docker cp /home/taishiro_murata/canvas-lms/nginxconf/ssl/canvas-lms/privkey.pem canvas-lms-jobs-1:/usr/src/app/ssl/privkey.pem

jobsコンテナ用にrce api用の証明書を配置する
sudo docker cp /home/taishiro_murata/canvas-lms/nginxconf/ssl/canvas-lms-rce-api/fullchain.pem canvas-lms-jobs-1:/usr/src/app/ssl/rce-api/fullchain.pem
sudo docker cp /home/taishiro_murata/canvas-lms/nginxconf/ssl/canvas-lms-rce-api/privkey.pem canvas-lms-jobs-1:/usr/src/app/ssl/rce-api/privkey.pem

