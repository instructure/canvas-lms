# See doc/docker/README.md or https://github.com/instructure/canvas-lms/tree/master/doc/docker
services:
  web:
    build:
      context: .
    links:
      - postgres
      - redis
    environment:
      POSTGRES_PASSWORD: sekret
    volumes:
      - ./:/usr/src/canvas:cached
      # - ./volumes/web:/usr/src/app
      - ./volumes/nginx:/etc/nginx/conf.d
    ports:
      - 80:80
      - 443:443
  jobs:
    build:
      context: .
    links:
      - postgres
      - redis
    volumes:
      - ./:/usr/src/canvas:cached
      - ./volumes/nginx:/etc/nginx/conf.d
    environment:
      POSTGRES_PASSWORD: sekret
  postgres:
    build: ./docker-compose/postgres
    environment:
      POSTGRES_PASSWORD: sekret
    command: postgres -c stats_temp_directory=/tmp
    volumes:
      - ./volumes/postgres/14:/var/lib/postgresql/data
    # 永続化したらバグった。なぜ。web側の永続化が問題な可能性もある。切り分け前。

  redis:
    image: redis:alpine